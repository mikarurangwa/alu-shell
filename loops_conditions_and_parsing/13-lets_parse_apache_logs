#!/usr/bin/env bash
# Script to parse Apache log file and display visitor IP along with HTTP status code

# Check if the log file exists
LOG_FILE="apache-access.log"

if [[ ! -f "$LOG_FILE" ]]; then
  echo "Log file not found!"
  exit 1
fi

# Check if the log file is empty
if [[ ! -s "$LOG_FILE" ]]; then
  echo "Log file is empty!"
  exit 0
fi

# Use awk to extract IP and HTTP status code, handle various log conditions
awk '
{
  ip = $1
  code = $9
  # Validate IP address format
  if (ip ~ /^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$/ && code ~ /^[0-9]{3}$/) {
    print ip, code
  }
}
' "$LOG_FILE"
